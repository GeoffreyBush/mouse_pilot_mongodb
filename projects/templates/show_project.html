{% extends 'base_template.html' %} {% load static %}
{% block title %}View Project{% endblock %} {% block content %}

<div class="container-fluid py-3">

	<div class="d-flex justify-content-between align-items-center mb-3">
		<h1>{{ project.project_name }}</h1>
	</div>

	<!-- Filter form -->
	<form method="get" class="mb-3">
		{% csrf_token %}
		<div class="row border">
			<div class="col-md-8 p-2">
				{{ filter_form.form }}
			</div>
			<div class="d-flex align-items-center justify-content-around col-md-4">
				<button type="submit" name="search" class="btn btn-primary">Search</button>
				<button type="submit" name="cancel" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</form>
	
		
	<form method="post" action="{% url 'projects:show_project' project_name=project.project_name %}">
		{% csrf_token %}

		<!-- Buttons 
		<div class="row">
				<div class="d-flex col-12 justify-content-start align-items-center mb-1 gap-2">

				</div>
		</div>
		-->
		<div class="row">
			<div>
				{% for error in form.mice.errors %}
					<div class="align-self-center" role="alert"><b>{{ error }}</b></div>
				{% endfor %}
			</div>

			<!-- Pagination -->
			{% if project_mice.has_other_pages %}
				<div class="pagination">
					{% if project_mice.has_previous %}
					<a href="?page={{ project_mice.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Previous</a>
					{% else %}
					<span class="disabled">Previous</span>
					{% endif %}

					{% for page_num in project_mice.paginator.page_range %}
					{% if page_num == project_mice.number %}
						<span class="current">{{ page_num }}</span>
					{% else %}
						<a href="?page={{ page_num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">{{ page_num }}</a>
					{% endif %}
					{% endfor %}

					{% if project_mice.has_next %}
					<a href="?page={{ project_mice.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Next</a>
					{% else %}
					<span class="disabled">Next</span>
					{% endif %}
				</div>
			{% endif %}

		</div>

		<!-- Table of mice -->
		<div class="row">
			<div class="col-6">
				<table class="table table-striped table-hover table-bordered m-2">
					<thead class="thead-light">
						<tr class="sticky-top">
							<th class="d-flex align-items-center p-0">
								<button class="btn btn-primary w-100 h-100" data-toggle="tooltip" data-placement="top" title="Request task on selected mice" name="add_request" type="submit">
								<b>R</b>
								</button>
							</th>
							<th>Mouse ID</th>
							<th>Sex</th>
							<th>Age (Days)</th>
							<th>Parents</th>
							<th>Earmark</th>
							<th>Activity</th>

						</tr>
					</thead>
					<tbody>
					{% for mouse in project_mice %}
					<tr>
						<td><input type="checkbox" name="mice" value='{{ mouse.pk }}'></td>
						<td 
						hx-get="{% url 'projects:info_panel' mouse.pk %}"
						hx-target="#info-panel"
						hx-trigger="click"
						>
						{{ mouse.pk }}
						</td>
						<td>{{ mouse.sex }}</td>
						<td>{{ mouse.age }}</td>
						<td>GUI</td>
						<td>{{ mouse.earmark }}</td>
					</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>


			<!-- Mouse info panel -->
			<div id="info-panel" class="border ms-5 col-5">
			</div>

		</div>
	</form>
	
</div>
<script src="https://d3js.org/d3.v5.min.js"></script>
{% endblock %}